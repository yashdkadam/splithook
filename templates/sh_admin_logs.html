<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>Document</title>
  </head>
  <body>
    <div class="navbar bg-base-100">
      <div class="navbar-start">
        <div class="dropdown">
          <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h7"
              />
            </svg>
          </div>
          <ul
            tabindex="0"
            class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow"
          >
            <li><a href="/admin/stocks">Stocks</a></li>
            <li><a href="/admin/logs">Logs</a></li>
            <li><a href="/admin/settings">Settings</a></li>
          </ul>
        </div>
      </div>
      <div class="navbar-center">
        <a class="btn btn-ghost text-2xl">SPLITHOOK</a>
      </div>
      <div class="navbar-end">
        <div class="dropdown dropdown-end">
          <div
            tabindex="0"
            role="button"
            class="btn btn-ghost btn-circle avatar"
          >
            <div class="w-10 rounded-full">
              <img
                alt="Tailwind CSS Navbar component"
                src="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp"
              />
            </div>
          </div>
          <ul
            tabindex="0"
            class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow"
          >
            <li>
              <a class="justify-between">
                Profile
                <span class="badge">New</span>
              </a>
            </li>
            <li><a>Settings</a></li>
            <li><button onclick="localStorage.clear();window.location.reload();" >Logout</button></li>

          </ul>
        </div>
      </div>
    </div>
    <div class="flex items-center justify-center">
      <div class="">
        <h1 class="text-center">Logs</h1>
        <div class="overflow-x-auto">
          <table class="table" id="logTable">
            <!-- head -->
            <thead>
              <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Action</th>
                <th>Timestamp</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated dynamically here -->
            </tbody>
          </table>

          <script>
            // for user validation before page load
            document.addEventListener("DOMContentLoaded", async () => {
              if (
                localStorage.getItem("username") == null ||
                localStorage.getItem("type") == null ||
                (localStorage.getItem("username") &&
                  localStorage.getItem("type") != "admin")
              ) {
                window.location.href = "/login";
              }
            });

            // Function to convert UNIX timestamp to readable format
            function formatTimestamp(unixTime) {
              const date = new Date(unixTime * 1000);
              return date.toLocaleString("en-GB", { hour12: true });
            }

            // Fetch data from the API and populate the table
            async function populateTable() {
              try {
                const response = await fetch(
                  "http://localhost:5000/admin/logs/get"
                );
                const data = await response.json();
                const tableBody = document.querySelector("#logTable tbody");

                data.forEach((log) => {
                  // Create a new row
                  const row = document.createElement("tr");

                  // Name cell
                  const nameCell = document.createElement("td");
                  nameCell.innerHTML = `
        <div class="flex items-center gap-3">
          <div class="font-bold">${log.symbol}</div>
        </div>
      `;
                  row.appendChild(nameCell);

                  // Quantity cell (assuming quantity is 50 for each, as in your example)
                  const quantityCell = document.createElement("td");
                  quantityCell.innerHTML = `<div class="font-bold">50</div>`;
                  row.appendChild(quantityCell);

                  // Action cell
                  const actionCell = document.createElement("td");
                  actionCell.innerHTML = `<div class="font-bold">${log.action.toUpperCase()}</div>`;
                  row.appendChild(actionCell);

                  // Timestamp cell
                  const timestampCell = document.createElement("td");
                  timestampCell.innerHTML = `<div class="font-bold">${formatTimestamp(
                    log.ordertime
                  )}</div>`;
                  row.appendChild(timestampCell);

                  // Append row to table body
                  tableBody.appendChild(row);
                });
              } catch (error) {
                console.error("Error fetching data:", error);
              }
            }

            // Call the function to populate the table on page load
            populateTable();
          </script>
        </div>
      </div>
    </div>
    <script src="https://cdn.tailwindcss.com"></script>
  </body>
</html>
